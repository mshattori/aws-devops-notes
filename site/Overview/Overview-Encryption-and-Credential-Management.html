<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Overview-Encryption-and-Credential-Management - AWS DevOps Notes</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    
    <header>
        <h1>Overview-Encryption-and-Credential-Management</h1>
    </header>
    
    <main>
        
<article>
    <h1 id="_1">暗号化・クリデンシャル管理</h1>
<p>Ref. <a href="References/AWS%20-%20Security%20-%20KMS,%20Secrets%20Manager,%20ACM.html">AWS - Security - KMS, Secrets Manager, ACM</a></p>
<h2 id="kms">KMS</h2>
<ul>
<li>暗号化に使うデータキーと、それを暗号化するマスターキーを管理するサービス。(鍵で鍵を暗号化するエンベロープ暗号化を実現)</li>
<li>CMK: Customer Master Key<ul>
<li>KMS 内の HSM で暗号化された状態で保管されるマスターキー。</li>
<li>対象鍵 (AES256), 非対称鍵 (RSA, ECC) がサポートされている。</li>
<li>キーローテーションがある。</li>
</ul>
</li>
<li>CDK: Customer Data Key<ul>
<li>データの暗号化に使用するキー。使用時以外は CMK で暗号化されたものをローカル保存。</li>
<li>対象鍵のデータキーと非対称鍵のデータキーペアがある。<ul>
<li>非対称なら公開鍵をアプリに保存して暗号化時に使用、復号時のみ秘密鍵を Decrypt して復号という使い方もできる。</li>
<li>非対称は署名用途にも使える。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>暗号化の手順</p>
<ul>
<li>GenerateDataKey で取得した平文データキー (Plaintext) で暗号化し、暗号化したデータを暗号化データキー (CiphertextBlob) とともに保管。</li>
<li>平文データキーは廃棄。</li>
</ul>
<p>復号の手順</p>
<ul>
<li>Decrypt で暗号化データキーを復号し、そのキーで暗号化データを復号。</li>
</ul>
<p>API</p>
<ul>
<li>CreateKey<ul>
<li>CMK を生成。KeyID が返り CMK そのものは返らない。</li>
</ul>
</li>
<li>GenerateDataKey/GenerateDataKeyPair<ul>
<li>KeyID を指定してデータキーを生成。データキーとして Plaintext と暗号化されたデータキーの CiphertextBlob が返る。</li>
<li>Plaintext でデータを暗号化して Plaintext は捨てる。暗号化後のデータを CiphertextBlob とともに保管。</li>
</ul>
</li>
<li>Decrypt<ul>
<li>CiphertextBlob を復号。KeyId は CiphertextBlob に含まれるので指定不要。</li>
</ul>
</li>
<li>Encrypt<ul>
<li>GenerateDataKey のデータキーを暗号化に使用するので、通常は使用しない。</li>
<li>CMK の KeyId と最大 4KB までの任意のデータを指定して呼び出す。暗号化された CiphertextBlob が返る。</li>
<li>CiphertextBlob には CMK の情報と暗号化されたデータが含まれる。Decrypt 時は KeyId 指定不要。</li>
<li>Usecase-1:  DB パスワードなどサイズの小さなシークレットを暗号化する場合。</li>
<li>Usecase-2: データキーをクロスリージョンで共有するために、データキーを別リージョンの CMK で暗号化して渡す。</li>
</ul>
</li>
</ul>
<p><strong>KMS Grant（権限委譲）</strong></p>
<ul>
<li>キーポリシーを変更せずに、一時的にKMSキー操作権限を委譲するAPI</li>
<li><code>Decrypt</code>, <code>GenerateDataKey</code> などの権限を特定プリンシパルに付与</li>
<li>取得された Grant Token を指定して API を呼び出す</li>
<li>代表ユースケース：AWSサービス連携時の動的権限委譲、外部システムの復号権限付与</li>
</ul>
<p><strong>Encryption Context</strong></p>
<ul>
<li>対称鍵での Encrypt/GenerateDataKey 時に指定できる Key/Value ペアの追加認証情報。</li>
<li>復号時に同じ Key/Value を渡す必要がある。</li>
<li>CloudTrail 証跡を暗号化する CMK のキーポリシーの <code>kms:EncryptionContext</code> 条件で暗号化を行う証跡の ARN を指定して制限する際に使う。</li>
<li>目的: 意図しない KMS キーで証跡データを暗号化してしまうのを防ぎ、この証跡だけがこの KMS キーを利用できるように制限するため。</li>
</ul>
<p>Systems Manager Parameter Store</p>
<p>Secrets Manager</p>
<hr />
</article>

    </main>
    <footer class="footer" role="contentinfo">
        <span class="footer__title" id="title">Overview-Encryption-and-Credential-Management</span>
        <span class="footer__percentage" aria-live="polite"><span id="scrollPercentage">0%</span></span>
    </footer>
    <script src="static/script.js"></script>
</body>
</html>