<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AWS - Auto Scaling, Multi AZ Region Account - AWS DevOps Notes</title>
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    
    <header>
        <h1>AWS - Auto Scaling, Multi AZ Region Account</h1>
    </header>
    
    <main>
        
<article>
    <h1 id="high-avairability-fault-tolerance-and-disaster-recovery">High Avairability, Fault Tolerance, and Disaster Recovery</h1>
<hr />
<h1 id="amazon-ec2-auto-scaling">Amazon EC2 Auto Scaling</h1>
<p>概要</p>
<ul>
<li>Auto Scaling グループのインスタンス数をスケーリングの設定に従ってスケールアウト。</li>
</ul>
<p><img alt="" src="_attachment/File.png" /></p>
<ul>
<li>
<p>構成要素</p>
<ul>
<li>Auto Scaling グループ</li>
<li>起動設定/起動テンプレート</li>
<li>スケーリングポリシー</li>
</ul>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/what-is-amazon-ec2-auto-scaling.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/what-is-amazon-ec2-auto-scaling.html</a></p>
</li>
<li>BB: <a href="https://d1.awsstatic.com/webinars/jp/pdf/services/20170315_AWS-BlackBelt-AutoScaling.pdf">https://d1.awsstatic.com/webinars/jp/pdf/services/20170315_AWS-BlackBelt-AutoScaling.pdf</a></li>
</ul>
<p><img alt="" src="_attachment/Presentation_Title_Here.png" /></p>
<h2 id="_1">起動設定/起動テンプレート</h2>
<p>起動設定 (Launch configuration)</p>
<ul>
<li>
<p>Auto Scaling グループで起動するインスタンスを設定する。</p>
<ul>
<li>EC2 の起動設定と同じ: AMI ID、インスタンスタイプ、キーペア、SG、ボリューム、UserData によるスクリプト実行、タグなど</li>
<li>サブネット(AZ) は Auto Scaling グループの設定が優先される。</li>
</ul>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/LaunchConfiguration.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/LaunchConfiguration.html</a></p>
</li>
</ul>
<p>起動テンプレート (Launch template)</p>
<ul>
<li>既存テンプレートから継承して別バージョンのテンプレートが作れる。</li>
<li><img alt="" src="_attachment/image_332.png" /></li>
<li>スポットインスタンスを起動できる (スポットフリートを起動テンプレートから作成)</li>
<li>
<p><img alt="" src="_attachment/image_333.png" /></p>
<ul>
<li>オンデマンドとミックスで使える。</li>
</ul>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/LaunchTemplates.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/LaunchTemplates.html</a></p>
</li>
</ul>
<p>Note:</p>
<ul>
<li>変更するとバージョン番号がインクリメントする。</li>
<li>作成した起動設定・テンプレートは複数の Auto Scaling グループに使用できる。</li>
<li>EC2 インスタンス指定で Auto Scaling グループを作成することもできる。その場合、起動設定が自動的に作成される。</li>
</ul>
<h1 id="auto-scaling">Auto Scaling グループ</h1>
<ul>
<li>
<p>Auto Scaling グループ単位で設定</p>
<ul>
<li>グループサイズ: 最大容量、最小容量、希望容量/Max,Min,Desired</li>
<li>起動設定/テンプレート。サブネット (AZ)。</li>
<li>スケーリングポリシー、終了 (Termination) ポリシー、ELB、ヘルスチェックタイプ。</li>
</ul>
</li>
<li>
<p>ELB 統合</p>
<ul>
<li>Auto Scaling グループに ELB のターゲットグループを設定できる。</li>
<li>Auto Scaling が ELB ターゲットグループに自動でインスタンスを追加・削除する。</li>
<li>CLB の場合は直接 CLB を選んでアタッチ。</li>
<li><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/attach-load-balancer-asg.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/attach-load-balancer-asg.html</a></li>
</ul>
</li>
<li>
<p>マルチ AZ でインスタンス数が均等になるようにバランシングされる。</p>
<ul>
<li>スケールイン時も<a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-instance-termination.html#default-termination-policy">デフォルトの終了ポリシー</a>は AZ 間でインスタンス数が均等になるよう終了インスタンスを選択する。</li>
<li>終了ポリシーはカスタマイズ可能。一番古いインスタンス、次に課金が発生するまでの期間が最も短いインスタンスなど。</li>
</ul>
</li>
<li>
<p>リージョンをまたいで設定することはできない。</p>
</li>
</ul>
<p>Ref. スケールアウト &lt;-&gt; スケールイン / スケールアップ &lt;-&gt; スケールダウン</p>
<p><a href="https://www.idcf.jp/words/scale-in.html">https://www.idcf.jp/words/scale-in.html</a></p>
<p>スケーリングの実施</p>
<ul>
<li>
<p>手動スケーリング (Manual Scaling)</p>
<ul>
<li>Auto Scaling グループの希望容量を手動でアドホックに変更する。</li>
<li>バッチ処理などの実施時や動作が不安定なインスタンスを切り離すのに使用。</li>
</ul>
</li>
<li>
<p>固定数インスタンスの維持</p>
<ul>
<li>最小容量(希望容量)の維持</li>
<li>最小容量、最大容量、希望容量に同じ値を設定</li>
</ul>
</li>
</ul>
<h2 id="scheduled-action">Scheduled Action (予定されたアクション)</h2>
<ul>
<li>グループサイズ (Max,Min,Desired) の変更をスケジュール</li>
<li>スケールアウトが必要な状況が予測可能なスケジュールで発生する場合に使用。</li>
<li>Cron, リピート, Once のスケジュール指定。</li>
<li><img alt="" src="_attachment/image_334.png" /></li>
</ul>
<h2 id="_2">動的スケーリングポリシー</h2>
<p>CloudWatch メトリクス/アラームに基づいてインスタンスを増減する動的スケーリング (Dynamic Scaling)</p>
<p>希望容量 (Desired capacity) が動的に変更されることでスケールアウト/インが発生する。</p>
<p><img alt="" src="_attachment/image_335.png" /></p>
<p>Target tracking scaling</p>
<ul>
<li>CloudWatch メトリクスのターゲット値を維持するようスケールアウト/インする。</li>
<li>例えば平均 CPU 使用率 50% を維持できるようにインスタンス数を増減。</li>
<li>
<p><img alt="" src="_attachment/image_336.png" /></p>
<ul>
<li>スケールアウト用・スケールイン用の2つの CloudWatch アラームが自動的に作成される。</li>
</ul>
</li>
<li>
<p>Warm up</p>
<ul>
<li>指定された秒数の間は新しいインスタンスの値はメトリクスに反映されない。</li>
<li>Cooldown より長くしてしまうとメトリクス反映前に再度スケーリングが発生してしまい問題になる。</li>
</ul>
</li>
<li>
<p>Disable scale-in</p>
<ul>
<li>このポリシーによるインスタンスの削除 (スケールイン) を無効化。</li>
</ul>
</li>
</ul>
<p>Step scaling</p>
<ul>
<li>CloudWatch アラームにスケーリング調整値を設定してインスタンス数を増減する。</li>
<li>平均 CPU 使用率 50% 超過アラームと、80% 超過アラームそれぞれにインスタンス追加数を個別に設定できる。</li>
<li><img alt="" src="_attachment/image_337.png" /></li>
<li>アクション: 追加・削除</li>
<li>単位: インスタンス数、割合</li>
</ul>
<p>Simple scaling</p>
<ul>
<li>Step scaling 以前からサポートされていたステップが1つしかない版。</li>
<li><img alt="" src="_attachment/image_338.png" /></li>
<li><br></li>
</ul>
<p>Predictive scaling</p>
<ul>
<li>AWS Auto Scaling による予測スケーリング。</li>
</ul>
<p>スケールイン</p>
<ul>
<li>作成したスケールアウトイベントについて、対応するスケールインイベントを作成することが重要。</li>
<li>スケーリングポリシーで CloudWatch アラームを指定するか、スケジュールスケーリングを指定する。<ul>
<li>つまりメトリクス基準でスケールインするか、定期的にスケールインさせるか。</li>
</ul>
</li>
</ul>
<p>参照</p>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/scaling_plan.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/scaling_plan.html</a></li>
<li><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-scale-based-on-demand.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-scale-based-on-demand.html</a></li>
</ul>
<p>クールダウン (Cooldown) とウォームアップ (Warmup)</p>
<ul>
<li>スケールアウト時のインスタンスの起動処理中に連続してアラームが発生した場合にインスタンスを立ち上げすぎないようにする機能。</li>
<li>
<p>クールダウン (デフォルト300秒)</p>
<ul>
<li>スケーリング実施後にアラームが連続して発生しても次のスケーリングを実施しない期間。</li>
<li>スケールアウト時は新たなインスタンスの起動タスクが実施されない。</li>
<li>スケールイン時は新たなインスタンスの停止タスクが実施されない。</li>
</ul>
</li>
<li>
<p>ウォームアップ</p>
<ul>
<li>新たに起動したインスタンスがスケーリングポリシーに反映されるまでの秒数。</li>
<li>インスタンス内の OS のブートアップやアプリケーションの起動時間を考慮。</li>
<li>台数追加がスケーリングされてもウォームアップ期間 (デフォルト300秒) 中のインスタンスを差し引いた台数しか追加しない。 </li>
</ul>
</li>
</ul>
<p><img alt="" src="_attachment/File_2.png" /></p>
<p><a href="https://dev.classmethod.jp/cloud/auto-scaling-steps/">https://dev.classmethod.jp/cloud/auto-scaling-steps/</a></p>
<ul>
<li><a href="https://dev.classmethod.jp/cloud/auto-scaling-steps/">https://dev.classmethod.jp/cloud/auto-scaling-steps/</a></li>
</ul>
<p>ヘルスチェック</p>
<ul>
<li>
<p>Auto Healing</p>
<ul>
<li>異常 (impared) 判定されたインスタンスを終了 (terminate) し新しいインスタンスを起動する。</li>
</ul>
</li>
<li>
<p>EC2 のヘルスチェック (デフォルト)</p>
<ul>
<li>システムステータスチェック: EC2 のインフラ由来の問題の検出</li>
<li>インスタンスステータスチェック: ARP によるヘルスチェック</li>
<li>1 分おきに実施される。</li>
<li><a href="https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/monitoring-system-instance-status-check.html">https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/monitoring-system-instance-status-check.html</a></li>
</ul>
</li>
<li>
<p>ELB によるヘルスチェック (オブション)</p>
<ul>
<li>ELB のターゲットグループを Auto Scaling グループに設定した場合に選択できる。</li>
<li>ELB のヘルスチェック (HTTP によるヘルスチェック) で判定して Auto Healing を実施。</li>
</ul>
</li>
<li>
<p>カスタムヘルスチェック</p>
<ul>
<li>独自のヘルスチェック機能から Unhealthy 状態を Auto Scaling に通知する。</li>
</ul>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/healthcheck.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/healthcheck.html</a></p>
</li>
</ul>
<h2 id="termination-policy">終了ポリシー (Termination Policy)</h2>
<p>デフォルト終了ポリシーの挙動:</p>
<ol>
<li>最もインスタンスの多い AZ を選択</li>
<li>Scale-in Protection がセットされていないインスタンスを選択</li>
<li>最も古い起動設定・テンプレートで起動されたものを選択</li>
<li>次の課金時間に最も近いものを選択。</li>
</ol>
<p>Ref. <a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/ec2-auto-scaling-termination-policies.html#default-termination-policy">https://docs.aws.amazon.com/autoscaling/ec2/userguide/ec2-auto-scaling-termination-policies.html#default-termination-policy</a></p>
<p><img alt="" src="_attachment/image_339.png" /></p>
<h2 id="_3">トラブルシューティング</h2>
<p>Suspended Process オプション</p>
<ul>
<li>Auto Scaling グループで特定の処理を停止する。</li>
</ul>
<p><img alt="" src="_attachment/image_340.png" /></p>
<ul>
<li>AlarmNotification: CloudWatch alarm を受け取らなくなる。</li>
</ul>
<p>Detach アクション</p>
<ul>
<li>インスタンスを Auto Scaling グループと ELB ターゲットグループからデタッチする。</li>
<li>代わりのインスタンスが起動される。</li>
<li>インスタンスのフォレンジックなどの際に使う。</li>
</ul>
<p>Set to Standby アクション</p>
<ul>
<li>インスタンスを ELB ターゲットグループからデタッチする。</li>
<li>他のインスタンスにトラフィックが振り分けられて負荷が上がる。</li>
</ul>
<p>Set Scale In Protection</p>
<ul>
<li>スケールイン時に対象インスタンスが削除対象にならないようにする。</li>
<li>バッチ処理中のインスタンスやマスターノードなどに動的に設定する。</li>
</ul>
<p><img alt="" src="_attachment/image_341.png" /></p>
<h2 id="_4">ライフサイクルフック</h2>
<p>インスタンスの起動・終了にフック待機 (デフォルト1時間) を入れられる。</p>
<p>スクリプト実行</p>
<ul>
<li>起動テンプレートの UserData のスクリプトが実行される</li>
</ul>
<p>通知</p>
<ul>
<li>SNS, SQS</li>
</ul>
<p>EventBridge/CloudWatch Events</p>
<ul>
<li>Auto Scaling の EC2 instance-launch Lifecycle Action/EC2 instance-terminate Lifecycle Action をイベントソースにできる</li>
<li>Lambda などで処理を実施後 CompleteLifecycleAction API をコールする。</li>
</ul>
<p>使用例:</p>
<ul>
<li>
<p>EC2_INSTANCE_LAUNCHING (Pending: Wait → Proceed)</p>
<ul>
<li>アプリケーション初期化処理の待機や SSM RunCommand などを実施。</li>
</ul>
</li>
<li>
<p>EC2_INSTANCE_TERMINATING (Terminating: Wait → Proceed)</p>
<ul>
<li>ログの待避やスナップショットなどを実施。</li>
</ul>
</li>
</ul>
<p><img alt="" src="_attachment/image_342.png" /></p>
<p>CompleteLifecycleAction の CLI 実行</p>
<pre><code>aws autoscaling complete-lifecycle-action --lifecycle-action-result CONTINUE --lifecycle-hook-name LaunchHook --auto-scaling-group-name demo-asg-launch-template --instance-id i-XXXXXXXXXXXX --region eu-west-1 --profile aws-devops

# lifecycle token can also be used instead of --instance-id if Lambda is used for example
</code></pre>
<p><a href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/lifecycle-hooks.html">https://docs.aws.amazon.com/autoscaling/ec2/userguide/lifecycle-hooks.html</a></p>
<p><a href="https://www.yamamanx.com/amazon-ec2-auto-scaling-lifecycle/">https://www.yamamanx.com/amazon-ec2-auto-scaling-lifecycle/</a></p>
<p><br></p>
<p>SQS キューサイズに応じてスケールアウト・インするユースケース</p>
<ul>
<li>SQS キューのサイズをカスタムメトリクスとして投入する</li>
<li>カスタムメトリクスを追跡するスケーリングポリシーを作成する</li>
</ul>
<p><img alt="" src="_attachment/image_343.png" /></p>
<p><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-using-sqs-queue.html">https://docs.aws.amazon.com/ja_jp/autoscaling/ec2/userguide/as-using-sqs-queue.html</a></p>
<h2 id="cloudformation-auto-scaling">CloudFormation による Auto Scaling 作成</h2>
<ul>
<li>CreationPolicy で希望容量のインスタンスからシグナルがあるまで ASG の作成成功を待機。</li>
<li>起動設定の UserData で cfn-signal を実施。</li>
</ul>
<pre><code>Resources:
  AutoScalingGroup:
    Type: AWS::AutoScaling::AutoScalingGroup
    Properties:
      AvailabilityZones:
        Fn::GetAZs:
          Ref: &quot;AWS::Region&quot;
      LaunchConfigurationName:
        Ref: LaunchConfig
      DesiredCapacity: '3'
      MinSize: '1'
      MaxSize: '4'
    CreationPolicy:
      ResourceSignal:
        Count: '3'
        Timeout: PT15M

  LaunchConfig:
    Type: AWS::AutoScaling::LaunchConfiguration
    Properties:
      ImageId: !Ref LatestLinuxAmiId
      InstanceType: t2.micro
      UserData:
        &quot;Fn::Base64&quot;:
          !Sub |
            #!/bin/bash -xe
            yum update -y aws-cfn-bootstrap
            /opt/aws/bin/cfn-signal -e $? --stack ${AWS::StackName} --resource AutoScalingGroup --region ${AWS::Region}
</code></pre>
<p>UpdatePolicy</p>
<ul>
<li>CFn スタック更新時にデフォルトでは既存インスタンスは置き換わらない。</li>
<li>
<p>UpdatePolicy で次の値を指定した場合にスタック更新でインスタンスがリプレースされる。</p>
<ul>
<li>AutoScalingReplacingUpdate ... Auto Scaling グループ全体を置き換える</li>
<li>AutoScalingRollingUpdate ... 既存 Auto Scaling グループ内で新しいインスタンスを立ててローリングアップデート</li>
</ul>
</li>
<li>
<p>AutoScalingScheduledAction &gt; IgnoreUnmodifiedGroupSizeProperties: true</p>
<ul>
<li>スケジュールアクションで変更されたグループサイズ (Max,Min,Desired) がスタック更新で上書きされないようにするオプション。</li>
<li>Auto Scaling グループにスケジュールアクションが設定されている場合、CFn テンプレートでグループサイズを変更していない限りはテンプレート更新でグループサイズを上書きしないようにする。</li>
</ul>
</li>
</ul>
<pre><code>Resources:
  AutoScalingGroup:
    Type: AWS::AutoScaling::AutoScalingGroup
    ... Snip ...
    UpdatePolicy:
      AutoScalingRollingUpdate:
        MinInstancesInService: '1'
        MaxBatchSize: '2'
        # how much time to wait for the signal
        PauseTime: PT1M
        WaitOnResourceSignals: 'true'
        # we can suspend processes during the update
        # SuspendProcesses:
        # - list of processes...
      AutoScalingScheduledAction:
        # Prevent Scheduled Actions from modifying min/max/desired for CloudFormation
        IgnoreUnmodifiedGroupSizeProperties: 'true'
</code></pre>
<pre><code>UpdatePolicy:
  AutoScalingReplacingUpdate:
    WillReplace: 'true'
</code></pre>
<p>Ref</p>
<ul>
<li><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html">https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-updatepolicy.html</a></li>
<li><a href="https://aws.amazon.com/jp/premiumsupport/knowledge-center/auto-scaling-group-rolling-updates/">https://aws.amazon.com/jp/premiumsupport/knowledge-center/auto-scaling-group-rolling-updates/</a></li>
</ul>
<h2 id="codedeploy-auto-scaling">CodeDeploy と Auto Scaling のインテグレーション</h2>
<p>Ref. <a href="AWS/AWS%20CICD.html">AWS: CI/CD</a></p>
<p>CodeDeploy のデプロイグループに Auto Scaling グループを指定できる。</p>
<ul>
<li>Auto Scaling グループ内の既存インスタンスとスケールアウトで新しく立ち上がるインスタンスに新しいリビジョンがデプロイされる。</li>
<li>デプロイタイプとしてインプレースとBlue/Green の両方が指定可能。</li>
<li>Blue/Green では AutoScalingReplacingUpdate 同様、Auto Scaling グループ全体を置き換える方法も選択できる。</li>
<li>トリッキーな点として、既存インスタンスへ新リビジョンをデプロイしている最中にスケールアウトが発生した場合、まだ新リビジョンデプロイが成功したとみなされていないため、以前のリビジョンが新しく立ち上がるインスタンスにデプロイされる。それを防ぐため、新しいデプロイを実施する間は Suspended Process オプションで「Launch」を停止するソリューションがある。</li>
</ul>
<p><a href="https://docs.aws.amazon.com/codedeploy/latest/userguide/integrations-aws-auto-scaling.html">https://docs.aws.amazon.com/codedeploy/latest/userguide/integrations-aws-auto-scaling.html</a></p>
<ul>
<li>以下の Auto Scaling イベントを terminate する: common_functions.sh というのでやってくれるそう<ul>
<li>AZRebalance</li>
<li>AlarmNotification</li>
<li>ScheduledActions</li>
<li>ReplaceUnhealthy</li>
</ul>
</li>
</ul>
<hr />
<h1 id="aws-auto-scaling">AWS Auto Scaling</h1>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/autoscaling/plans/userguide/what-is-aws-auto-scaling.html">https://docs.aws.amazon.com/ja_jp/autoscaling/plans/userguide/what-is-aws-auto-scaling.html</a></li>
<li>EC2 以外のサービスも Auto Scaling できる。</li>
<li><strong>EC2, EC2 スポットフリートリクエスト, ECS ホスト, EMR クラスターノード, Aurora レプリカ</strong> </li>
<li><strong>DynamoDB キャパシティ, Kinesis Data Streams シャード</strong></li>
<li>
<p>Amazon EC2 Auto Scaling グループ:</p>
<ul>
<li>Auto Scaling グループの EC2 インスタンスを起動または削除。</li>
</ul>
</li>
<li>
<p>Amazon EC2 スポットフリートリクエスト:</p>
<ul>
<li>スポットフリートリクエストからインスタンスを起動または削除します。または、料金や容量の問題で中断されたインスタンスを自動的に置き換えます。</li>
</ul>
</li>
<li>
<p>Amazon ECS</p>
<ul>
<li>負荷の変化に応じて ECS ホストの必要数の増減を調整します。</li>
<li>コンテナをホストするインスタンスを増減。コンテナの管理は ECS が実施。</li>
</ul>
</li>
<li>
<p>Amazon DynamoDB</p>
<ul>
<li>DynamoDB テーブルまたはグローバルセカンダリインデックスを有効にして、プロビジョニングされた読み取りおよび書き込みキャパシティを増減させ、スロットリングなしでトラフィックの増加を処理します。</li>
</ul>
</li>
<li>
<p>Amazon Aurora</p>
<ul>
<li>Aurora リードレプリカの数を動的に調整して、アクティブな接続やワークロードの変化を処理。</li>
<li>RDS のリードレプリカには対応していない。</li>
</ul>
</li>
<li>
<p>現在利用できるスケーリング機能は動的スケーリングと予測スケーリングです。</p>
</li>
<li>
<p>動的スケーリング</p>
<ul>
<li>ターゲット追跡スケーリングポリシーにより、リソース使用率を指定されたターゲット値に維持するために、スケーリングプランが各リソースのキャパシティを増減。</li>
</ul>
</li>
<li>
<p>予測スケーリング (Predictive scaling):</p>
<ul>
<li>負荷予測: 指定された負荷メトリクスの最大 14 日間の履歴を分析して、次の 2 日の今後の需要を予測します。このデータは 1 時間間隔で利用でき、毎日更新されます。</li>
<li>スケジュールされたスケーリングアクション: 負荷予測を反映してプロアクティブにリソースキャパシティを追加および削除するスケーリングアクションをスケジュールします。スケジュールされた時刻になると、AWS Auto Scaling はリソースの最小容量を、スケジュールされたスケーリングアクションで指定された値に基づいて更新します。これは、リソースの使用率をスケーリング戦略で指定されたターゲット値に維持するためです。アプリケーションが予測よりも多くの容量を必要とする場合は、動的スケーリングを使用して追加のキャパシティを追加できます。</li>
<li>最大キャパシティの動作: リソースごとに、最小キャパシティと最大キャパシティの制限があり、スケジュールされたスケーリングアクションによって指定される値はその範囲内が存在することが望まれます。ただし、予測キャパシティが最大キャパシティよりも大きい場合に、アプリケーションが最大キャパシティを超えてリソースを追加できるかどうかを制御できます。</li>
<li>現在、予測スケーリングは Amazon EC2 Auto Scaling グループでのみ使用できます。</li>
</ul>
</li>
</ul>
<hr />
<h1 id="multi-azmulti-region">Multi AZ/Multi Region</h1>
<p><img alt="" src="_attachment/image_344.png" /></p>
<p>EBS は AZ リソース。Multi AZ に対応するにはスナップショットを使ったハックが必要になる。</p>
<p><img alt="" src="_attachment/image_345.png" /><img alt="" src="_attachment/image_346.png" /></p>
<p>CloudFormation StackSets</p>
<ul>
<li>クロスアカウント/クロスリージョンに同一スタックを1 度のオペレーションで作成、更新、削除できる。</li>
</ul>
<p>CodePipeline クロスリージョン・クロスアカウント</p>
<ul>
<li>クロスリージョンや本番アカウントへのサービスデプロイ。</li>
<li>アーティファクトストア (S3) へのコピーやアクセスのためのポリシー設定必要になる。</li>
</ul>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<p>RPO: Recovery Point Objective - バックアップを取る周期</p>
<p>RTO: Recovery Time Objective - リカバリにかかる時間</p>
<p><img alt="" src="_attachment/image_347.png" /><img alt="" src="_attachment/image_348.png" /></p>
<p>Pilot Light ... クリティカルなシステムだけ Warm Standby にする。</p>
<p><img alt="" src="_attachment/image_349.png" /><img alt="" src="_attachment/image_350.png" /></p>
<p><img alt="" src="_attachment/image_351.png" /></p>
<p><a href="AWS/AWS%20Security%20IAM,%20STS,%20Organization.html">AWS: Security: IAM, STS, Organization</a></p>
<p><img alt="" src="_attachment/image_352.png" /></p>
<h2 id="control-tower">Control Tower</h2>
<p><a href="AWS/AWS%20Security%20CloudFormation,%20Service%20Catalog,%20Control%20Tower.html">AWS: Security: CloudFormation, Service Catalog, Control Tower</a></p>
<p><img alt="" src="_attachment/image_353.png" /></p>
<p><br></p>
</article>

    </main>
    <footer>
        <p>&copy; 2025 AWS DevOps Notes</p>
    </footer>
    <script src="static/script.js"></script>
</body>
</html>